<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Portfolio</title>
  <link rel="stylesheet" href="css/form-style.css">
  <link rel="stylesheet" href="css/website-style.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    .no-js #themeIcon {
      display: none;
    }
        
  </style>
</head>
<body data-theme="light">
  <noscript>
    <p><strong>JavaScript is disabled.</strong> Some features may not work properly. Please enable JavaScript for the best experience.</p>
  </noscript>
  
  <header>
    <div class="header-container">
      <h1>Ulises</h1>
      <nav class="main-nav">
        <ul>
          <li><a href="#about-me">About Me</a></li>
          <li><a href="#resume">Resume</a></li>
          <li><a href="#portfolio">Portfolio</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </nav>
      <button id="themeToggle" aria-label="Toggle Dark Mode">
        <img id="themeIcon" src="images/moon-icon.svg" alt="Toggle Theme">
      </button>
    </div>
  </header>

  <section id="hero">
    <div class="hero-content">
      <h2>Journey</h2>
    </div>
  </section>

  <main>
    <!-- about me -->
    <section id="about-me">
      <h2>About Me</h2>
      <div class="two-column">
        <!-- left column -->
        <article>
          <h3>BIO</h3>
          <p>My current goals are to become a better programmer and reach 1000 LeetCode problems solved by the end of this year.</p>
          <p>Outside of programming, I enjoy cooking, running, and playing chess. I hope to increase my chess Elo and run a marathon this year!</p>
          <p><strong>Personal</strong></p>
          <p>My favorite foods are spaghetti, avocados, and steak. I also love In-N-Out and milkshakes.</p>
          <p>Basketball is my favorite sport to watchâ€”and I play it during my free time.</p>
        </article>
        <!-- right column - image -->
        <aside>
          <figure>
            <picture>
              <source srcset="images/profilepic.webp" type="image/webp">
              <source srcset="images/profilepic.jpg" type="image/jpeg">
              <img src="images/profilepic.jpg" alt="Portrait of Ulises" class="responsive-img">
            </picture>
            <figcaption><em>Picture of me!</em></figcaption>
          </figure>
        </aside>
      </div>
    </section>

    <!-- Resume Section -->
    <section id="resume">
      <h2>Resume</h2>
      <div class="responsive-pdf">
        <iframe src="pdf/resume.pdf#zoom=page-width" title="Ulises's Resume" allowfullscreen></iframe>
      </div>
    </section>

    <!-- project section -->
    <section id="portfolio">
      <h2>Portfolio/Projects</h2>
      <div id="buttons">
        <button id="load-local-btn">Load Local</button>
        <button id="load-remote-btn">Load Remote</button>
      </div>

      <div id="cards-container"></div>
    </section>
  </main>

  <footer>
    <section id="contact">
      <h2>Connect</h2>
      <address class="contact-icons">
        <a href="https://www.linkedin.com/in/ulises-salinas/" target="_blank" rel="noopener">
          <picture>
            <source srcset="images/linkedin-icon.webp" type="image/webp">
            <source srcset="images/linkedin-icon.svg" type="image/svg">
            <img src="images/linkedin-icon.svg" alt="LinkedIn">
          </picture>
        </a>
        <a href="https://github.com/ulises0516" target="_blank" rel="noopener">
          <picture>
            <source srcset="images/github-icon.webp" type="image/webp">
            <source srcset="images/github-icon.svg" type="image/svg">
            <img src="images/github-icon.svg" alt="GitHub">
          </picture>
        </a>
        <a href="mailto:usalinas595@gmail.com">
          <picture>
            <source srcset="images/email-icon.webp" type="image/webp">
            <source srcset="images/email-icon.svg" type="image/svg">
            <img src="images/email-icon.svg" alt="Email">
          </picture>
        </a>
      </address>
      <div id="contactModalContainer">
        <form id="contactForm" action="https://httpbin.org/post" method="post" novalidate>
          <input type="hidden" id="form-errors" name="form-errors" value="[]" />
          <h2>Contact Me</h2>
          <label for="name" class="required">Name</label>
          <input type="text" id="name" name="name" required pattern="^[A-Za-z\s'\-]+$" placeholder="Your Name" title="Name can only contain letters, spaces, apostrophes, or hyphens.">
          <label for="email" class="required">Email</label>
          <input type="email" id="email" name="email" required placeholder="john@domain.com" title="Please enter a valid email address.">
          <label for="comments" class="required">Comments</label>
          <div class="textarea-container">
            <textarea id="comments" name="comments" required minlength="20" maxlength="500" placeholder="message..."></textarea>
            <div id="charCount" class="char-counter">Characters remaining: 500</div>
          </div>
          <div id="errorOutput" class="error-output" aria-live="polite"></div>
          <input type="hidden" name="possible_bot" value="true">
          <div class="form-buttons">
            <button type="submit" id="submitBtn" class="submit-modal-btn">Submit</button>
          </div>
        </form>
      </div>
    </section>
    <p>&copy; 2024 Ulises Blog</p>
  </footer>

  <script>
    document.documentElement.classList.remove('no-js');
    document.documentElement.classList.add('js');

    // Theme toggle functionality
    document.addEventListener('DOMContentLoaded', () => {
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      const storedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', storedTheme);
      themeIcon.src = storedTheme === 'dark' ? "images/sun-icon.webp" : "images/moon-icon.svg";
      themeToggle.setAttribute("aria-label", storedTheme === "dark" ? "Switch to Light Mode" : "Switch to Dark Mode");
      themeToggle.addEventListener('click', () => {
        const newTheme = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
        themeIcon.src = newTheme === "dark" ? "images/sun-icon.webp" : "images/moon-icon.svg";
        themeToggle.setAttribute("aria-label", newTheme === "dark" ? "Switch to Light Mode" : "Switch to Dark Mode");
      });
    });
    document.addEventListener('DOMContentLoaded', () => {
      let form_errors = [];
      const form             = document.getElementById('contactForm');
      const nameInput        = document.getElementById('name');
      const emailInput       = document.getElementById('email');
      const commentsTxtarea  = document.getElementById('comments');
      const charCount        = document.getElementById('charCount');
      const errorOutput      = document.getElementById('errorOutput');
      const formErrField     = document.getElementById('form-errors');
    
      const allowedCharRegex = /[A-Za-z\s'\-]/; 
      const maxChars = 500;
    
      console.log({ form, nameInput, emailInput, commentsTxtarea, charCount, errorOutput, formErrField });
    
      nameInput.addEventListener('input', () => {
        console.log("Name input event triggered");
        const originalValue = nameInput.value;
        const sanitizedValue = originalValue
          .split('')
          .filter(ch => allowedCharRegex.test(ch))
          .join('');
    
        if (originalValue !== sanitizedValue) {
          nameInput.classList.add('flash');
          nameInput.setCustomValidity("Name can only contain letters, spaces, apostrophes, or hyphens.");
          nameInput.value = sanitizedValue;
          setTimeout(() => {
            nameInput.classList.remove('flash');
          }, 500);
        } else {
          nameInput.setCustomValidity("");
        }
        showFieldErrors();
      });
    
      commentsTxtarea.addEventListener('input', () => {
        const currentLength = commentsTxtarea.value.length;
        const remaining = maxChars - currentLength;
        charCount.textContent = `characters remaining: ${remaining}`;
    
        if (remaining < 100) {
          charCount.classList.add('warning');
        } else {
          charCount.classList.remove('warning');
        }
    
        if (remaining < 0) {
          commentsTxtarea.setCustomValidity("You have exceeded the maximum allowed characters.");
        } else {
          commentsTxtarea.setCustomValidity("");
        }
        showFieldErrors();
      });
    
      emailInput.addEventListener('blur', showFieldErrors);
      nameInput.addEventListener('blur', showFieldErrors);
      commentsTxtarea.addEventListener('blur', showFieldErrors);
    
      function showFieldErrors() {
        let messages = [];
    
        if (!nameInput.value.trim()) {
          messages.push("Name cannot be empty.");
        } else if (!nameInput.validity.valid) {
          messages.push(`Name ("${nameInput.value}"): ${nameInput.validationMessage}`);
        }
    
        if (!emailInput.value.trim()) {
          messages.push("Email cannot be empty.");
        } else if (!emailInput.validity.valid) {
          messages.push("Invalid email format.");
        }
    
        if (!commentsTxtarea.value.trim()) {
          messages.push("Comments cannot be empty.");
        } else if (commentsTxtarea.value.length < 20) {
          messages.push("Comments must be at least 20 characters.");
        } else if (!commentsTxtarea.validity.valid) {
          messages.push(commentsTxtarea.validationMessage);
        }
    
        if (messages.length > 0) {
          errorOutput.innerHTML = messages.join("<br>");
          errorOutput.style.display = "block";
          errorOutput.style.opacity = 1;
          setTimeout(() => {
            errorOutput.style.transition = "opacity 1s ease-out";
            errorOutput.style.opacity = 0;
          }, 3000);
        
          errorOutput.addEventListener('transitionend', () => {
            if (errorOutput.style.opacity === "0") {
              errorOutput.style.display = "none";
            }
          });

        } else {
          errorOutput.innerHTML = "";
          errorOutput.style.display = "none";
        }
      }
    
      form.addEventListener('submit', (e) => {
        form_errors = [];
        let messages = [];
        if (nameInput.value.trim()) {
          if (!nameInput.validity.valid) {
            messages.push(`Name ("${nameInput.value}"): ${nameInput.validationMessage}`);
            form_errors.push({
              field: 'name',
              error: nameInput.validationMessage,
              value: nameInput.value
            });
          }
        } else {
          messages.push("Name cannot be empty.");
          form_errors.push({
            field: 'name',
            error: "Name cannot be empty.",
            value: nameInput.value
          });
        }
    
        if (!emailInput.value.trim()) {
          messages.push("Email cannot be empty.");
          form_errors.push({
            field: 'email',
            error: "Email cannot be empty.",
            value: emailInput.value
          });
        } else if (!emailInput.validity.valid) {
          messages.push("Invalid email format.");
          form_errors.push({
            field: 'email',
            error: "Invalid email format.",
            value: emailInput.value
          });
        }
    
        if (!commentsTxtarea.value.trim()) {
          messages.push("Comments cannot be empty.");
          form_errors.push({
            field: 'comments',
            error: "comments cannot be empty.",
            value: commentsTxtarea.value
          });
        } else if (commentsTxtarea.value.length < 20) {
          messages.push("Comments must be at least 20 characters.");
          form_errors.push({
            field: 'comments',
            error: "comments must be at least 20 characters.",
            value: commentsTxtarea.value
          });
        } else if (!commentsTxtarea.validity.valid) {
          messages.push(commentsTxtarea.validationMessage);
          form_errors.push({
            field: 'comments',
            error: commentsTxtarea.validationMessage,
            value: commentsTxtarea.value
          });
        }
    
        if (messages.length > 0) {
          e.preventDefault();
          errorOutput.innerHTML = messages.join("<br>");
          errorOutput.style.display = "block";
        } else {
          errorOutput.innerHTML = "";
          errorOutput.style.display = "none";
        }
      
        formErrField.value = JSON.stringify(form_errors);
      });
    });
  </script>

  <script>
    class ProjectCard extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({ mode: 'open' });
      }
      connectedCallback() {
        const title = this.getAttribute('data-title') || 'project title';
        const description = this.getAttribute('data-description') || '...';
        const imageUrl = this.getAttribute('data-image') || '';
        const imageAlt = this.getAttribute('data-image-alt') || 'Project image';
        const link = this.getAttribute('data-link') || '#';
        this.render(title, description, imageUrl, imageAlt, link);
      }
      render(title, description, imageUrl, imageAlt, link) {
        this.shadowRoot.innerHTML = `
          <style>
            :host {
              display: block;
              font-family: sans-serif;
            }
            .card {
              background-color: var(--card-background);
              border: 1px solid var(--card-border);
              border-radius: var(--card-radius);
              box-shadow: var(--card-shadow);
              padding: var(--card-padding);
              color: var(--card-text-color);
              height: 100%;
              display: flex;
              flex-direction: column;
              transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            .card:hover {
              transform: translateY(-3px);
              box-shadow: 0 6px 12px rgba(0, 0, 0, 0.12);
            }
            .card picture,
            .card img {
              width: 100%;
              object-fit: cover;
              border-radius: var(--card-radius) var(--card-radius) 0 0;
            }

            .card h2 {
              margin: 1rem 0 0.5rem;
              color: var(--card-title-color);
              font-size: 1.2rem;
            }

            .card p {
              flex: 1;
              margin: 0 0 1rem;
              line-height: 1.4;
            }

            .card a {
              display: inline-block;
              color: #fff;
              background-color: var(--card-link-color);
              padding: 0.5rem 1rem;
              border-radius: 20px;
              text-decoration: none;
              font-weight: 600;
              transition: background-color 0.2s ease;
            }
            .card a:hover {
              background-color: var(--card-link-hover-color);
            }
          </style>
          <div class="card">
            <picture>
              <source srcset="${imageUrl}" type="image/webp">
              <img src="${imageUrl}" alt="${imageAlt}">
            </picture>
            <h2>${title}</h2>
            <p>${description}</p>
            <a href="${link}" target="_blank" rel="noopener">Read More</a>
          </div>
        `;
      }
    }
    customElements.define('project-card', ProjectCard);

    function storeProjectsToLocal(projects) {
      localStorage.setItem('projects', JSON.stringify(projects));
    }

    // fetch from local storage
    function loadLocalProjects() {
      const localData = localStorage.getItem('projects');
      if (localData) {
        try {
          return JSON.parse(localData);
        } catch (e) {
          console.error('Error parsing local projects:', e);
        }
      }
      return [
        
      ];
    }

    // fetch from json server
    async function fetchRemoteProjects() {
      try {
        const response = await fetch("https://my-json-server.typicode.com/ulises0516/completed-website/projects");
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return await response.json();
      } catch (error) {
        console.error('Error fetching remote projects:', error);
        return [];
      }
    }

    function displayProjects(projects) {
      const container = document.getElementById('cards-container');
      container.innerHTML = '';
      projects.forEach(project => {
        const card = document.createElement('project-card');
        card.setAttribute('data-title', project.title);
        card.setAttribute('data-description', project.description);
        card.setAttribute('data-image', project.image);
        card.setAttribute('data-image-alt', project.imageAlt);
        card.setAttribute('data-link', project.link);
        container.appendChild(card);
      });
    }
    document.getElementById('load-local-btn').addEventListener('click', () => {
      const localProjects = loadLocalProjects();
      if (localProjects.length === 0) {
        alert("load remote data first (no local data)");
      } else {
        displayProjects(localProjects);
      }
    });

    document.getElementById('load-remote-btn').addEventListener('click', async () => {
      const remoteProjects = await fetchRemoteProjects();
      console.log(remoteProjects)
      if (remoteProjects.length > 0) {
        storeProjectsToLocal(remoteProjects);
        displayProjects(remoteProjects);
      } else {
        alert("Remote data could not be loaded.");
      }
    });

  </script>
</body>
</html>
